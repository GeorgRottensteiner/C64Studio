using GR.Memory;
using System;
using System.Collections.Generic;
using System.Text;



namespace Tiny64
{
  public class Memory
  {
    public enum ReadType
    {
      READ_AS_CPU,
      READ_FROM_RAM
    }

    public enum MemorySource
    {
      RAM,
      UNDEFINED,
      CART_LO,
      CART_HI,
      BASIC_ROM,
      IO,
      CHARSET_ROM,
      KERNAL_ROM
    }



    public byte[]         RAM = new byte[65536];
    public byte[]         Kernal = new byte[8192];
    public byte[]         BASICROM = new byte[8192];
    public byte[]         CharacterROM = new byte[4096];
    public byte[]         ColorRAM = new byte[1024];
    public byte[]         CartLO = new byte[16384];
    public byte[]         CartHI = new byte[16384];

    internal MemorySource   Range0000To0FFF = MemorySource.RAM;
    internal MemorySource   Range1000To7FFF = MemorySource.RAM;
    internal MemorySource   Range8000To9FFF = MemorySource.RAM;
    internal MemorySource   RangeA000ToBFFF = MemorySource.BASIC_ROM;
    internal MemorySource   RangeC000ToCFFF = MemorySource.RAM;
    internal MemorySource   RangeD000ToDFFF = MemorySource.IO;
    internal MemorySource   RangeE000ToFFFF = MemorySource.KERNAL_ROM;

    Machine               Machine = null;




    public Memory( Machine Machine )
    {
      this.Machine = Machine;
    }



    internal void Initialize()
    {
      RAM = new byte[65536];
      ColorRAM = new byte[1024];
      CartLO = new byte[16384];
      CartHI = new byte[16384];

      Kernal          = StringToByteArray( "8556200FBCA561C988900320D4BA20CCBCA507186981F0F338E90148A205B569B46195619469CA10F5A55685702053B820B4BFA9C4A0BF2059E0A900856F6820B9BA608571847220CABBA9572028BA205DE0A957A0004C28BA8571847220C7BBB1718567A471C898D002E6728571A4722028BAA571A4721869059001C8857184722067B8A95CA000C667D0E4609835447A006828B14600202BBC3037D02020F3FF86228423A004B1228562C8B1228564A008B1228563C8B12285654CE3E0A98BA00020A2BBA98DA0E02028BAA992A0E02067B8A665A56285658662A663A56485638664A9008566A5618570A980856120D7B8A28BA0004CD4BBC9F0D007843886374C63A6AAD002A21E4C37A420D2FFB0E86020CFFFB0E26020ADE4B0DC6020C6FFB0D66020E4FFB0D060208AAD20F7B7A9E148A94648AD0F0348AD0C03AE0D03AC0E03286C1400088D0C038E0D038C0E03688D0F036020D4E1A62DA42EA92B20D8FFB09560A9012CA900850A20D4E1A50AA62BA42C20D5FFB057A50AF017A21C20B7FF2910D017A57AC902F007A964A0A34C1EAB6020B7FF29BFF005A21D4C37A4A57BC902D00E862D842EA976A0A3201EAB4C2AA5208EA62033A54C77A62019E220C0FFB00B602019E2A54920C3FF90C34CF9E0A90020BDFFA201A00020BAFF2006E22057E22006E22000E2A000864920BAFF2006E22000E28AA8A6494CBAFF200EE24C9EB7207900D00268686020FDAE207900D0F74C08AFA90020BDFF2011E2209EB786498AA201A00020BAFF2006E22000E2864AA000A549E00390018820BAFF2006E22000E28AA8A64AA54920BAFF2006E2200EE2209EAD20A3B6A622A4234CBDFFA9E0A0E22067B8200CBCA9E5A0E2A66E2007BB200CBC20CCBCA900856F2053B8A9EAA0E22050B8A56648100D2049B8A5663009A51249FF851220B4BFA9EAA0E22067B868100320B4BFA9EFA0E24C43E020CABBA9008512206BE2A24EA00020F6E0A957A00020A2BBA9008566A51220DCE2A94EA0004C0FBB484C9DE281490FDAA283490FDAA27F000000000584E61A2D1B862807FBF88799688901872335DFE186A55DE72883490FDAA2A56648100320B4BFA56148C9819007A9BCA0B9200FBBA93EA0E32043E068C9819007A9E0A0E22050B86810034CB4BF600B76B383BDD3791EF4A6F57B83FCB0107C0C1F67CA7CDE53CBC17D1464704C7DB7EA517A7D6330887E7E9244993A7E4CCC91C77FAAAAAA13810000000020CCFFA9008513207AA658A2806C00038A30034C3AA44C74A42053E420BFE32022E4A2FB9AD0E4E67AD002E67BAD60EAC93AB00AC920F0EF38E93038E9D060804FC75258A94C85548D1003A948A0B28D11038C1203A991A0B385058406A9AAA0B185038404A21CBDA2E39573CA10F8A9038553A900856885138518A2018EFD018EFC01A219861638209CFF862B842C382099FF8637843886338434A00098912BE62BD002E62C60A52BA42C2008A4A973A0E4201EABA53738E52BAAA538E52C20CDBDA960A0E4201EAB4C44A68BE383A47CA51AA7E4A786AEA20BBD47E49D0003CA10F7600020424153494320425954455320465245450D00930D202020202A2A2A2A20434F4D4D4F444F5245203634204241534943205632202A2A2A2A0D0D2036344B2052414D2053595354454D202000814820C9FFAA6890018A60AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA85A9A90185AB60AD860291F3606902A491C8D004C5A1D0F760192644191A11E80D700C0606D1023701AE006900A200A0DC60A228A01960B00786D684D3206CE5A6D6A4D36020A0E5A9008D910285CFA9488D8F02A9EB8D9002A90A8D89028D8C02A90E8D8602A9048D8B02A90C85CD85CCAD88020980A8A900AA94D91869289001C8E8E01AD0F3A9FF95D9A21820FFE9CA10FAA00084D384D6A6D6A5D3B4D9300818692885D3CA10F420F0E9A927E8B4D93006186928E810F685D54C24EAE4C9F0034CEDE660EA20A0E54C66E5A903859AA9008599A22FBDB8EC9DFFCFCAD0F760AC7702A200BD78029D7702E8E4C6D0F5C6C6985818602016E7A5C685CC8D9202F0F778A5CFF00CA5CEAE8702A00084CF2013EA20B4E5C983D010A2097886C6BDE6EC9D7602CAD0F7F0CFC90DD0C8A4D584D0B1D1C920D00388D0F7C884C8A0008C920284D384D4A5C9301BA6D62091E5E4C9D012A5CA85D3C5C8900AB02B98488A48A5D0F093A4D3B1D185D7293F06D724D7100209809004A6D4D00470020940E6D32084E6C4C8D017A90085D0A90DA699E003F006A69AE003F0032016E7A90D85D768AA68A8A5D7C9DED002A9FF1860C922D008A5D4490185D4A922600940A6C7F0020980A6D8F002C6D8AE86022013EA20B6E668A8A5D8F00246D468AA6818586020B3E8E6D3A5D5C5D3B03FC94FF032AD9202F0034C67E9A6D6E019900720EAE8C6D6A6D616D956D9E8B5D9098095D9CAA5D518692885D5B5D93003CAD0F94CF0E9C6D6207CE8A90085D360A6D6D00686D36868D09DCA86D6206CE5A4D584D3604885D78A489848A90085D0A4D3A5D710034CD4E7C90DD0034C91E8C9209010C960900429DFD002293F2084E64C93E6A6D8F0034C97E6C914D02E98D0062001E74C73E720A1E88884D32024EAC8B1D18891D1C8B1F38891F3C8C4D5D0EFA92091D1AD860291F3104DA6D4F0034C97E6C912D00285C7C913D0032066E5C91DD017C820B3E884D388C4D59009C6D6207CE8A00084D34CA8E6C911D01D18986928A8E6D6C5D590ECF0EAC6D6E928900485D3D0F8207CE84CA8E620CBE84C44EC297FC97FD002A95EC92090034C91E6C90DD0034C91E8A6D4D03FC914D037A4D5B1D1C920D004C4D3D007C04FF0242065E9A4D52024EA88B1D1C891D188B1F3C891F388C4D3D0EFA92091D1AD860291F3E6D84CA8E6A6D8F00509404C97E6C911D016A6D6F037C6D6A5D338E928900485D3102A206CE5D025C912D004A90085C7C91DD01298F00920A1E88884D34CA8E62001E74CA8E6C913D0062044E54CA8E6098020CBE84C4FEC46C9A6D6E8E019D00320EAE8B5D910F486D64C6CE5A20086D886C786D486D3207CE84CA8E6A202A900C5D3F007186928CAD0F660C6D660A202A927C5D3F007186928CAD0F660A6D6E019F002E6D660A20FDDDAE8F004CA10F8608E86026090051C9F9C1E1F9E8195969798999A9BA5AC48A5AD48A5AE48A5AF48A2FFC6D6C6C9CEA502E820F0E9E018B00CBDF1EC85ACB5DA20C8E930EC20FFE9A200B5D9297FB4DA1002098095D9E8E018D0EFA5F1098085F1A5D910C3E6D6EEA502A97F8D00DCAD01DCC9FB08A97F8D00DC28D00BA000EACAD0FC88D0F984C6A6D66885AF6885AE6885AD6885AC60A6D6E8B5D910FB8EA502E018F00E900C20EAE8AEA502CAC6D64CDAE6A5AC48A5AD48A5AE48A5AF48A219CA20F0E9ECA502900EF00CBDEFEC85ACB5D820C8E930E920FFE9A217ECA502900FB5DA297FB4D91002098095DACAD0ECAEA50220DAE64C58E929030D880285AD20E0E9A027B1AC91D1B1AE91F38810F5602024EAA5AC85AEA5AD290309D885AF60BDF0EC85D1B5D929030D880285D260A02720F0E92024EA20DAE4A92091D18810F660EAA8A90285CD2024EA98A4D391D18A91F360A5D185F3A5D2290309D885F46020EAFFA5CCD029C6CDD025A91485CDA4D346CFAE8702B1D1B011E6CF85CE2024EAB1F38D8702AE8602A5CE4980201CEAA5012910F00AA00084C0A5010920D008A5C0D006A501291F85012087EAAD0DDC68A868AA6840A9008D8D02A04084CB8D00DCAE01DCE0FFF061A8A98185F5A9EB85F6A9FE8D00DCA20848AD01DCCD01DCD0F84AB01648B1F5C905B00CC903F0080D8D028D8D02100284CB68C8C041B00BCAD0DF38682A8D00DCD0CC686C8F02A4CBB1F5AAC4C5F007A0108C8C02D036297F2C8A0230167049C97FF029C914F00CC920F008C91DF004C911D035AC8C02F005CE8C02D02BCE8B02D026A0048C8B02A4C688101CA4CB84C5AC8D028C8E02E0FFF00E8AA6C6EC8902B0069D7702E886C6A97F8D00DC60AD8D02C903D015CD8E02F0EEAD9102301DAD18D049028D18D04C76EB0AC9089002A906AABD79EB85F5BD7AEB85F64CE0EA81EBC2EB03EC78EC140D1D8885868711335741345A5345013552443643465458375947384248555639494A304D4B4F4E2B504C2D2E3A402C5C2A3B13013D5E2F315F043220025103FF948D9D8C898A8B9123D7C124DAD3C50125D2C426C3C6D4D827D9C728C2C8D5D629C9CA30CDCBCFCEDBD0CCDD3E5BBA3CA9C05D93013DDE3F215F0422A002D183FF948D9D8C898A8B9196B3B097ADAEB10198B2AC99BCBBA3BD9AB7A59BBFB4B8BE29A2B530A7A1B9AAA6AFB6DC3E5BA43CA8DF5D93013DDE3F815F0495A002AB83FFC90ED007AD18D00902D009C98ED00BAD18D029FD8D18D04CA8E6C908D007A9800D91023009C909D0EEA97F2D91028D91024CA8E6FFFFFFFFFFFFFFFF1C17019F1A1305FF9C12041E030614181F19079E0208151612090A920D0B0F0EFF100CFFFF1B00FF1CFF1DFFFF1F1EFF9006FF05FFFF11FFFF00000000000000000000000000000000009B370000000800140F0000000000000E060102030400010203040506074C4F41440D52554E0D00285078A0C8F018406890B8E008305880A8D0F820487098C009402C092020A4F0482494100A3866A32040ED469446A3688595782097EEC93FD0032085EEAD00DD09088D00DD78208EEE2097EE20B3EE782097EE20A9EEB0642085EE24A3100A20A9EE90FB20A9EEB0FB20A9EE90FB208EEEA90885A5AD00DDCD00DDD0F80A903F6695B00520A0EED0032097EE2085EEEAEAEAEAAD00DD29DF09108D00DDC6A5D0D4A9048D07DCA9198D0FDCAD0DDCAD0DDC2902D00A20A9EEB0F45860A9802CA903201CFE5818904A85952036EDAD00DD29F78D00DD6085952036ED7820A0EE20BEED2085EE20A9EE30FB586024943005386694D005482040ED688595186078208EEEAD00DD09088D00DDA95F2CA93F2011ED20BEED8AA20ACAD0FDAA2085EE4C97EE78A90085A52085EE20A9EE10FBA9018D07DCA9198D0FDC2097EEAD0DDCAD0DDC2902D00720A9EE30F41018A5A5F005A9024CB2ED20A0EE2085EEA940201CFEE6A5D0CAA90885A5AD00DDCD00DDD0F80A10F566A4AD00DDCD00DDD0F80A30F5C6A5D0E420A0EE249050032006EEA5A4581860AD00DD29EF8D00DD60AD00DD09108D00DD60AD00DD29DF8D00DD60AD00DD09208D00DD60AD00DDCD00DDD0F80A608AA2B8CAD0FDAA60A5B4F047303F46B6A2009001CA8A45BD85BDC6B4F0068A290485B560A9202C9402F014301C7014A5BDD001CAC6B4AD930210E3C6B4D0DFE6B4D0F0A5BDF0EDD0EA70E950E6E6B4A2FFD0CBAD94024A90072C01DD101D501EA90085BD85B5AE980286B4AC9D02CC9E02F013B1F985B6EE9D0260A9402CA9100D97028D9702A9018D0DDD4DA10209808DA1028D0DDD60A209A9202C9302F001CA5002CACA60A6A9D033C6A8F036300DA5A745AB85AB46A766AA60C6A8A5A7F067AD93020AA90165A8D0EFA9908D0DDD0DA1028DA10285A9A9024C3BEFA5A7D0EA4CD3E4AC9B02C8CC9C02F02A8C9B0288A5AAAE9802E009F0044AE8D0F891F7A9202C9402F0B430B1A5A745ABF00370A92C50A6A9012CA9042CA9802CA9020D97028D97024C7EEFA5AAD0F1F0EC859AAD94024A9029A9022C01DD101DD020ADA1022902D0F92C01DD70FBAD01DD09028D01DD2C01DD700730F9A9408D970218602028F0AC9E02C8CC9D02F0F48C9E0288A59E91F9ADA1024AB01EA9108D0EDDAD99028D04DDAD9A028D05DDA981203BEF2006EFA9118D0EDD608599AD94024A90282908F024A9022C01DD10ADF022ADA1024AB0FAAD01DD29FD8D01DDAD01DD2904F0F9A990184C3BEFADA1022912F0F31860AD9702AC9C02CC9B02F00B29F78D9702B1F7EE9C026009088D9702A9006048ADA102F011ADA1022903D0F9A9108D0DDDA9008DA10268600D492F4F204552524F5220A30D534541524348494E47A0464F52A00D505245535320504C4159204F4E20544150C55052455353205245434F5244202620504C4159204F4E20544150C50D4C4F4144494EC70D534156494E47A00D564552494659494EC70D464F554E44A00D4F4B8D249D100DB9BDF008297F20D2FFC82810F31860A599D008A5C6F00F784CB4E5C902D01884972086F0A4971860A599D00BA5D385CAA5D685C94C32E6C903D00985D0A5D585C84C32E6B038C902F03F86972099F1B016482099F1B00DD005A940201CFEC6A6A6976860AA688AA69760200DF8D00B2041F8B011A90085A6F0F0B1B21860A590F004A90D18604C13EE204EF1B0F7C900D0F2AD97022960D0E9F0EE48A59AC903D004684C16E79004684CDDED4A68859E8A4898489023200DF8D00E2064F8B00EA902A00091B2C884A6A59E91B21868A868AAA59E9002A900602017F04CFCF1200FF3F0034C01F7201FF3A5BAF016C903F012B014C902D0034C4DF0A6B9E060F0034C0AF785991860AA2009EDA5B9100620CCED4C48F220C7ED8A249010E64C07F7200FF3F0034C01F7201FF3A5BAD0034C0DF7C903F00FB011C902D0034CE1EFA6B9E060F0EA859A1860AA200CEDA5B9100520BEEDD00320B9ED8A249010E74C07F72014F3F0021860201FF38A48A5BAF050C903F04CB047C902D01D6820F2F22083F42027FEA5F8F001C8A5FAF001C8A90085F885FA4C7DF4A5B9290FF02320D0F7A9003820DDF12064F8900468A90060A5B9C962D00BA905206AF74CF1F22042F668AAC698E498F014A498B959029D5902B963029D6302B96D029D6D021860A90085908AA698CA3015DD5902D0F860BD590285B8BD630285BABD6D0285B960A9008598A203E49AB00320FEEDE499B00320EFED869AA900859960A6B8D0034C0AF7200FF3D0034CFEF6A698E00A90034CFBF6E698A5B89D5902A5B9096085B99D6D02A5BA9D6302F05AC903F056900520D5F3904FC902D0034C09F420D0F7B0034C13F7A5B9290FD01F2017F8B03620AFF5A5B7F00A20EAF79018F0284C04F7202CF7F020900CB0F42038F8B017A904206AF7A9BFA4B9C060F007A000A90291B29885A61860A5B930FAA4B7F0F6A9008590A5BA200CEDA5B909F020B9EDA590100568684C07F7A5B7F00CA000B1BB20DDEDC8C4B7D0F64C54F62083F48C9702C4B7F00AB1BB999302C8C004D0F2204AEF8E9802AD9302290FF01C0AAAADA602D009BCC1FEBDC0FE4C40F4BCEBE4BDEAE48C96028D9502AD95020A202EFFAD94024A9009AD01DD0AB003200DF0AD9B028D9C02AD9E028D9D022027FEA5F8D0058884F886F7A5FAD0058884FA86F938A9F04C2DFEA97F8D0DDDA9068D03DD8D01DDA9040D00DD8D00DDA0008CA1026086C384C46C30038593A9008590A5BAD0034C13F7C903F0F9907BA4B7D0034C10F7A6B920AFF5A96085B920D5F3A5BA2009EDA5B920C7ED2013EE85AEA5904A4AB0502013EE85AF8AD008A5C385AEA5C485AF20D2F5A9FD2590859020E1FFD0034C33F62013EEAAA5904A4AB0E88AA493F00CA000D1AEF008A910201CFE2C91AEE6AED002E6AF249050CB20EFED2042F690794C04F74AB0034C13F720D0F7B0034C13F72017F8B06820AFF5A5B7F00920EAF7900BF05AB0DA202CF7F053B0D3A590291038D04AE001F011E003D0DDA001B1B285C3C8B1B285C4B004A5B9D0EFA003B1B2A001F1B2AAA004B1B2A002F1B2A8188A65C385AE9865C485AFA5C385C1A5C485C220D2F5204AF82418A6AEA4AF60A59D101EA00C202FF1A5B7F015A017202FF1A4B7F00CA000B1BB20D2FFC8C4B7D0F660A049A593F002A0594C2BF186AE84AFAAB50085C1B50185C26C3203A5BAD0034C13F7C903F0F9905FA96185B9A4B7D0034C10F720D5F3208FF6A5BA200CEDA5B920B9EDA000208EFBA5AC20DDEDA5AD20DDED20D1FCB016B1AC20DDED20E1FFD0072042F6A900386020DBFCD0E520FEED24B93011A5BA200CEDA5B929EF09E020B9ED20FEED18604AB0034C13F720D0F7908D2038F8B025208FF6A203A5B92901D002A2018A206AF7B0122067F8B00DA5B92902F006A905206AF7241860A59D10FBA051202FF14CC1F5A200E6A2D006E6A1D002E6A038A5A2E901A5A1E91AA5A0E94F900686A086A186A2AD01DCCD01DCD0F8AA3013A2BD8E00DCAE01DCEC01DCD0F88D00DCE8D00285916078A5A2A6A1A4A07885A286A184A05860A591C97FD0070820CCFF85C62860A9012CA9022CA9032CA9042CA9052CA9062CA9072CA9082CA9094820CCFFA000249D500A202FF16848093020D2FF683860A593482041F8688593B032A000B1B2C905F02AC901F008C903F004C904D0E1AA249D1017A063202FF1A005B1B220D2FFC8C015D0F6A5A120E0E4EA188860859E20D0F7905EA5C248A5C148A5AF48A5AE48A0BFA92091B288D0FBA59E91B2C8A5C191B2C8A5C291B2C8A5AE91B2C8A5AF91B2C8849FA000849EA49EC4B7F00CB1BBA49F91B2E69EE69FD0EE20D7F7A96985AB206BF8A86885AE6885AF6885C16885C29860A6B2A4B3C0026020D0F78A85C11869C085AE9885C2690085AF60202CF7B01DA005849FA000849EC4B7F010B1BBA49FD1B2D0E7E69EE69FA49ED0EC186020D0F7E6A6A4A6C0C060202EF8F01AA01B202FF120D0F8202EF8D0F8A06A4C2FF1A9102401D00224011860202EF8F0F9A02ED0DDA9008590859320D7F72017F8B01F78A90085AA85B485B0859E859F859CA990A20ED01120D7F7A91485AB2038F8B06C78A982A208A07F8C0DDC8D0DDCAD0EDC09198D0FDC29918DA20220A4F0AD11D029EF8D11D0AD14038D9F02AD15038DA00220BDFCA90285BE2097FBA501291F850185C0A2FFA0FF88D0FDCAD0F858ADA002CD150318F01520D0F820BCF64CBEF820E1FF18D00B2093FC386868A9008DA0026086B1A5B00A0A1865B01865B185B1A90024B030012A06B12A06B12AAAAD06DCC91690F965B18D04DC8A6D07DC8D05DCADA2028D0EDC8DA402AD0DDC2910F009A9F948A92A484C43FF5860AE07DCA0FF98ED06DCEC07DCD0F286B1AA8C06DC8C07DCA9198D0FDCAD0DDC8DA30298E5B186B14A66B14A66B1A5B018693CC5B1B04AA69CF0034C60FAA6A3301BA200693065B0C5B1B01CE8692665B0C5B1B017692C65B0C5B190034C10FAA5B4F01D85A8D019E6A9B002C6A938E913E5B165928592A5A4490185A4F02B86D7A5B4F022ADA3022901D005ADA402D016A90085A48DA402A5A3103030BFA2A620E2F8A59BD0B94CBCFEA592F0073003C6B02CE6B0A9008592E4D7D00F8AD0A0A5A930BDC91090B98596B0B58A459B859BA5B4F0D2C6A330C546D766BFA2DA20E2F84CBCFEA596F004A5B4F007A5A330034C97F946B1A99338E5B165B00AAA20E2F8E69CA5B4D011A596F02685A8A9008596A9818D0DDC85B4A59685B5F009A90085B4A9018D0DDCA5BF85BDA5A805A985B64CBCFE2097FB859CA2DA20E2F8A5BEF00285A7A90F24AA1017A5B5D00CA6BECAD00BA908201CFED004A90085AA4CBCFE7031D018A5B5D0F5A5B6D0F1A5A74AA5BD3003901818B015290F85AAC6AAD0DDA94085AA208EFBA90085ABF0D0A98085AAD0CAA5B5F00AA904201CFEA9004C4AFB20D1FC90034C48FBA6A7CAF02DA593F00CA000A5BDD1ACF004A90185B6A5B6F04BA23DE49E903EA69EA5AD9D0101A5AC9D0001E8E8869E4C3AFBA69FE49EF035A5ACDD0001D02EA5ADDD0101D027E69FE69FA593F00BA5BDA000D1ACF017C884B6A5B6F007A910201CFED009A593D005A8A5BD91AC20DBFCD043A98085AA78A2018E0DDCAE0DDCA6BECA300286BEC6A7F008A59ED02785BEF0232093FC208EFBA00084ABB1AC45AB85AB20DBFC20D1FC90F2A5AB45BDF005A920201CFE4CBCFEA5C285ADA5C185AC60A90885A3A90085A485A8859B85A960A5BD4AA9609002A9B0A2008D06DC8E07DCAD0DDCA9198D0FDCA501490885012908603866B6303CA5A8D012A910A20120B1FBD02FE6A8A5B610294C57FCA5A9D00920ADFBD01DE6A9D01920A6FBD014A5A4490185A4F00FA5BD490185BD2901459B859B4CBCFE46BDC6A3A5A3F03A10F32097FB58A5A5F012A20086D7C6A5A6BEE002D002098085BDD0D920D1FC900AD091E6ADA5D785BDB0CAA000B1AC85BD45D785D720DBFCD0BBA59B490185BD4CBCFEC6BED00320CAFCA95085A7A2087820BDFCD0EAA97820AFFBD0E3C6A7D0DF2097FBC6AB10D8A20A20BDFC58E6ABA5BEF030208EFBA20986A586B6D0830878AD11D009108D11D020CAFCA97F8D0DDC20DDFDADA002F0098D1503AD9F028D140328602093FCF097BD93FD8D1403BD94FD8D150360A501092085016038A5ACE5AEA5ADE5AF60E6ACD002E6AD60A2FF789AD82002FDD0036C00808E16D020A3FD2050FD2015FD205BFF586C00A0A205BD0FFDDD0380D003CAD0F560C3C2CD3830A230A0FD1886C384C4A01FB91403B002B1C391C39914038810F16031EA66FE47FE4AF391F20EF250F233F357F1CAF1EDF63EF12FF366FEA5F4EDF5A900A8990200990002990003C8D0F4A23CA00386B284B3A8A90385C2E6C2B1C1AAA95591C1D1C1D00F2A91C1D1C1D0088A91C1C8D0E8F0E498AAA4C218202DFEA9088D8202A9048D8802606AFCCDFB31EA2CF9A97F8D0DDC8D0DDD8D00DCA9088D0EDC8D0EDD8D0FDC8D0FDDA2008E03DC8E03DD8E18D4CA8E02DCA9078D00DDA93F8D02DDA9E78501A92F8500ADA602F00AA9258D04DCA9404CF3FDA9958D04DCA9428D05DC4C6EFF85B786BB84BC6085B886BA84B960A5BAC902D00DAD970248A9008D97026860859DA59005908590608D8502609006AE8302AC84028E83028C8402609006AE8102AC82028E81028C820260786C1803488A489848A97F8D0DDDAC0DDD301C2002FDD0036C028020BCF620E1FFD00C2015FD20A3FD2018E56C02A0982DA102AA2901F028AD00DD29FB05B58D00DDADA1028D0DDD8A2912F00D2902F00620D6FE4C9DFE2007FF20BBEE4CB6FE8A2902F00620D6FE4CB6FE8A2910F0032007FFADA1028D0DDD68A868AA6840C1273E1AC511740EED0C4506F0024601B8007100AD01DD290185A7AD06DDE91C6D99028D06DDAD07DD6D9A028D07DDA9118D0FDDADA1028D0DDDA9FF8D06DD8D07DD4C59EFAD95028D06DDAD96028D07DDA9118D0FDDA9124DA1028DA102A9FF8D06DD8D07DDAE980286A860AAAD96022AA88A69C88D99029869008D9A0260EAEA086829EF48488A489848BABD04012910F0036C16036C14032018E5AD12D0D0FBAD19D029018DA6024CDDFDA9818D0DDCAD0EDC298009118D0EDC4C8EEE034C5BFF4CA3FD4C50FD4C15FD4C1AFD4C18FE4CB9ED4CC7ED4C25FE4C34FE4C87EA4C21FE4C13EE4CDDED4CEFED4CFEED4C0CED4C09ED4C07FE4C00FE4CF9FD6C1A036C1C036C1E036C20036C22036C24036C26034C9EF44CDDF54CE4F64CDDF66C28036C2A036C2C034C9BF64C05E54C0AE54C00E55252425943FEE2FC48FF" );
      BASICROM        = StringToByteArray( "94E37BE343424D424153494330A841A71DADF7A8A4ABBEAB80B005ACA4A99FA870A827A91CA882A8D1A83AA92EA84AA92CB867E155E164E1B2B323B87FAA9FAA56A89BA65DA685AA29E1BDE1C6E17AAB41A639BCCCBC58BC10037DB39EB371BF97E0EAB9EDBF64E26BE2B4E20EE30DB87CB765B4ADB78BB7ECB600B72CB737B77969B87952B87B2ABA7B11BB7F7ABF50E8AF46E5AF7DB3BF5AD3AE6415B0454EC4464FD24E4558D4444154C1494E505554A3494E5055D44449CD524541C44C45D4474F54CF5255CE49C6524553544F52C5474F5355C25245545552CE5245CD53544FD04FCE574149D44C4F41C4534156C55645524946D94445C6504F4BC55052494E54A35052494ED4434F4ED44C4953D4434CD2434DC45359D34F5045CE434C4F53C54745D44E45D7544142A854CF46CE535043A8544845CE4E4FD4535445D0ABADAAAFDE414EC44FD2BEBDBC5347CE494ED44142D35553D24652C5504FD35351D2524EC44C4FC74558D0434FD35349CE5441CE4154CE504545CB4C45CE535452A45641CC4153C3434852A44C454654A45249474854A44D4944A447CF00544F4F204D414E592046494C45D346494C45204F5045CE46494C45204E4F54204F5045CE46494C45204E4F5420464F554EC4444556494345204E4F542050524553454ED44E4F5420494E5055542046494CC54E4F54204F55545055542046494CC54D495353494E472046494C45204E414DC5494C4C4547414C20444556494345204E554D4245D24E45585420574954484F555420464FD253594E5441D852455455524E20574954484F555420474F5355C24F5554204F4620444154C1494C4C4547414C205155414E544954D94F564552464C4FD74F5554204F46204D454D4F52D9554E44454627442053544154454D454ED4424144205355425343524950D4524544494D27442041525241D94449564953494F4E204259205A4552CF494C4C4547414C204449524543D454595045204D49534D415443C8535452494E4720544F4F204C4F4EC746494C4520444154C1464F524D554C4120544F4F20434F4D504C45D843414E275420434F4E54494E55C5554E44454627442046554E4354494FCE5645524946D94C4F41C49EA1ACA1B5A1C2A1D0A1E2A1F0A1FFA110A225A235A23BA24FA25AA26AA272A27FA290A29DA2AAA2BAA2C8A2D5A2E4A2EDA200A30EA31EA324A383A30D4F4B0D0020204552524F520020494E20000D0A52454144592E0D0A000D0A425245414B00A0BAE8E8E8E8BD0101C981D021A54AD00ABD02018549BD0301854ADD0301D007A549DD0201F0078A186912AAD0D8602008A48531843238A55AE55F8522A8A55BE560AAE898F023A55A38E522855AB003C65B38A558E5228558B008C6599004B15A915888D0F9B15A9158C65BC659CAD0F2600A693EB0358522BAE422902E60C4349028D004C533902248A2099848B557CA10FA2026B5A2F7689561E830FA68A868C4349006D005C533B00160A2106C00038A0AAABD26A38522BD27A3852320CCFFA900851320D7AA2045ABA000B12248297F2047ABC86810F4207AA6A969A0A3201EABA43AC8F00320C2BDA976A0A3201EABA9802090FF6C02032060A5867A847B207300AAF0F0A2FF863A90062079A54CE1A7206BA92079A5840B2013A69044A001B15F8523A52D8522A5608525A55F88F15F18652D852D8524A52E69FF852EE560AA38A55FE52DA8B003E8C6251865229003C62318B1229124C8D0F9E623E625CAD0F22059A62033A5AD0002F08818A52D855A650B8558A42E845B9001C8845920B8A3A514A4158DFE018CFF01A531A432852D842EA40B88B9FC01915F8810F82059A62033A54C80A4A52BA42C8522842318A001B122F01DA004C8B122D0FBC8986522AAA0009122A5236900C891228622852390DD60A2002012E1C90DF00D9D0002E8E05990F1A2174C37A44CCAAA6C0403A67AA004840FBD00021007C9FFF03EE8D0F4C920F0378508C922F056240F702DC93FD004A999D025C9309004C93C901D8471A000840B88867ACAC8E8BD000238F99EA0F0F5C980D030050BA471E8C899FB01B9FB01F03638E93AF004C949D002850F38E955D09F8508BD0002F0DFC508F0DBC899FB01E8D0F0A67AE60BC8B99DA010FAB99EA0D0B4BD000210BE99FD01C67BA9FF857A60A52BA62CA001855F8660B15FF01FC8C8A515D15F9018F00388D009A51488D15F900CF00A88B15FAA88B15FB0D71860D0FDA900A8912BC8912BA52B186902852DA52C6900852E208EA6A900D02D20E7FFA537A43885338434A52DA42E852F843085318432201DA8A219861668A868A2FA9A489848A900853E85106018A52B69FF857AA52C69FF857B609006F004C9ABD0E9206BA92013A6207900F00CC9ABD08E207300206BA9D0866868A5140515D006A9FF85148515A001840FB15FF043202CA820D7AAC8B15FAAC8B15FC515D004E414F002B02C844920CDBDA920A449297F2047ABC922D006A50F49FF850FC8F011B15FD010A8B15FAAC8B15F865F8560D0B54C86E36C060310D7C9FFF0D3240F30CF38E97FAA8449A0FFCAF008C8B99EA010FA30F5C8B99EA030B22047ABD0F5A980851020A5A9208AA3D0058A690FAA9A6868A90920FBA32006A91898657A48A57B690048A53A48A53948A9A420FFAE208DAD208AADA566097F25628562A98BA0A7852284234C43AEA9BCA0B920A2BB207900C9A9D006207300208AAD202BBC2038AEA54A48A54948A98148202CA8A57AA47BC002EAF004853D843EA000B17AD043A002B17A18D0034C4BA8C8B17A8539C8B17A853A98657A857A9002E67B6C080320730020EDA74CAEA7F03CE9809011C923B0170AA8B90DA048B90CA0484C73004CA5A9C93AF0D64C08AFC94BD0F9207300A9A420FFAE4CA0A838A52BE901A42CB00188854184426020E1FFB00118D03CA57AA47BA63AE8F00C853D843EA539A43A853B843C6868A981A0A390034C69A44C86E3D017A21AA43ED0034C37A4A53D857A847BA53BA43C8539843A6008A9002090FF28D0034C59A62060A64C97A8A90320FBA3A57B48A57A48A53A48A53948A98D4820790020A0A84CAEA7206BA92009A938A539E514A53AE515B00B9838657AA67B9007E8B004A52BA62C2017A6901EA55FE901857AA560E900857B60D0FDA9FF854A208AA39AC98DF00BA20C2CA2114C37A44C08AF6868853968853A68857A68857B2006A99818657A857A9002E67B60A23A2CA2008607A0008408A508A60785078608B17AF0E8C508F0E4C8C922D0F3F0E9209EAD207900C989F005A9A720FFAEA561D0052009A9F0BB207900B0034CA0A84CEDA7209EB748C98DF004C989D091C665D004684CEFA7207300206BA9C92CF0EE6860A20086148615B0F7E92F8507A5158522C919B0D4A5140A26220A262265148514A5226515851506142615A514650785149002E6152073004C71A9208BB08549844AA9B220FFAEA50E48A50D48209EAD682A2090ADD018681012201BBC20BFB1A000A5649149C8A5659149604CD0BB68A44AC0BFD04C20A6B6C906D03DA000846184668471201DAA20E2BAE671A471201DAA200CBCAAF005E88A20EDBAA471C8C006D0DF20E2BA209BBCA664A463A5654CDBFFB12220800090034C48B2E92F4C7EBDA002B164C5349017D00788B164C533900EA465C42E9008D00DA564C52DB007A564A4654C68AAA000B1642075B4A550A451856F8470207AB6A961A0008550845120DBB6A000B1509149C8B1509149C8B1509149602086AA4CB5AB209EB7F005A92C20FFAE0886132018E1284CA0AA2021AB207900F035F043C9A3F050C9A618F04BC92CF037C93BF05E209EAD240D30DE20DDBD2087B42021AB203BABD0D3A9009D0002A2FFA001A513D010A90D2047AB24131005A90A2047AB49FF603820F0FF9838E90AB0FC49FF6901D016083820F0FF8409209BB7C929D0592890068AE5099005AAE8CAD0062073004CA2AA203BABD0F22087B420A6B6AAA000E8CAF0BCB1222047ABC8C90DD0F320E5AA4C28ABA513F003A9202CA91D2CA93F200CE129FF60A511F0113004A0FFD004A53FA4408539843A4C08AFA513F005A2184C37A4A90CA0AD201EABA53DA43E857A847B6020A6B3C923D010207300209EB7A92C20FFAE8613201EE1A201A002A9008D0102A940200FACA613D01360209EB7A92C20FFAE8613201EE120CEABA51320CCFFA200861360C922D00B20BDAEA93B20FFAE2021AB20A6B3A92C8DFF0120F9ABA513F00D20B7FF2902F00620B5AB4CF8A8AD0002D01EA513D0E32006A94CFBA8A513D0062045AB203BAB4C60A5A641A442A9982CA900851186438444208BB08549844AA57AA47B854B844CA643A444867A847B207900D0202411500C2024E18D0002A2FFA001D00C3075A513D0032045AB20F9AB867A847B207300240D103124115009E8867AA9008507F00C8507C922F007A93A8507A92C188508A57AA47B69009001C8208DB420E2B720DAA94C91AC20F3BCA50E20C2A9207900F007C92CF0034C4DABA57AA47B85438444A54BA44C857A847B207900F02D20FDAE4C15AC2006A9C8AAD012A20DC8B17AF06CC8B17A853FC8B17AC8854020FBA8207900AAE083D0DC4C51ACA543A444A61110034C27A8A000B143F00BA513D007A9FCA0AC4C1EAB603F45585452412049474E4F5245440D003F5245444F2046524F4D2053544152540D00D004A000F003208BB08549844A208AA3F005A20A4C37A49A8A186904486906852468A00120A2BBBABD09018566A549A44A2067B820D0BBA001205DBCBA38FD0901F017BD0F018539BD1001853ABD1201857ABD1101857B4CAEA78A6911AA9A207900C92CD0F12073002024AD209EAD182438240D3003B00360B0FDA2164C37A4A67AD002C67BC67AA20024488A48A90120FBA32083AEA900854D20790038E9B19017C903B013C9012A4901454DC54D9061854D2073004CBBADA64DD02CB07B69079077650DD0034C3DB669FF85220A6522A868D980A0B067208DAD482020AE68A44B1017AAF056D05F460D8A2AA67AD002C67BC67AA01B854DD0D7D980A0B04890D9B982A048B981A0482033AEA54D4CA9AD4C08AFA566BE80A0A8688522E6226885239848201BBCA56548A56448A56348A56248A561486C2200A0FF68F023C964F003208DAD844B684A851268856968856A68856B68856C68856D68856E4566856FA561606C0A03A900850D207300B0034CF3BC2013B190034C28AFC9FFD00FA9A8A0AE20A2BB4C730082490FDAA1C92EF0DEC9ABF058C9AAF0D1C922D00FA57AA47B69009001C82087B44CE2B7C9A8D013A018D03B20BFB1A56549FFA8A56449FF4C91B3C9A5D0034CF4B3C9B490034CA7AF20FAAE209EADA9292CA9282CA92CA000D17AD0034C7300A20B4C37A4A01568684CFAAD38A564E900A565E9A09008A9A2E564A9E3E56560208BB085648465A645A446A50DF026A90085702014AF901CE054D018C0C9D0142084AF845E888471A006845DA0242068BE4C6FB460240E100DA000B164AAC8B164A88A4C91B32014AF902DE054D01BC049D0252084AF98A2A04C4FBC20DEFF866484638565A000846260E053D00AC054D00620B7FF4C3CBCA564A4654CA2BB0A48AA207300E08F902020FAAE209EAD20FDAE208FAD68AAA56548A564488A48209EB768A88A484CD6AF20F1AE68A8B9EA9F8555B9EB9F85562054004C8DADA0FF2CA000840B20BFB1A564450B8507A565450B850820FCBB20BFB1A565450B2508450BA8A564450B2507450B4C91B32090ADB013A56E097F256A856AA969A000205BBCAA4C61B0A900850DC64D20A6B6856186628463A56CA46D20AAB6866C846DAA38E561F008A9019004A661A9FF8566A0FFE8C8CAD007A666300F18900CB16CD162F0EFA2FFB002A201E88A2A2512F002A9FF4C3CBC20FDAEAA2090B0207900D0F460A200207900860C85452079002013B1B0034C08AFA200860D860E20730090052013B1900BAA20730090FB2013B1B0F6C924D006A9FF850DD010C925D013A510D0D0A980850E054585458A0980AA2073008646380510E928D0034CD1B1A0008410A52DA62E8660855FE430D004C52FF022A545D15FD008A546C8D15FF07D8818A55F690790E1E8D0DCC9419005E95B38E9A5606848C92AD005A913A0BF60A545A446C954D00BC0C9F0EFC049D0034C08AFC953D004C054F0F5A52FA430855F8460A531A432855A845B1869079001C88558845920B8A3A558A459C8852F8430A000A545915FC8A546915FA900C8915FC8915FC8915FC8915FC8915FA55F186902A4609001C88547844860A50B0A6905655FA4609001C88558845960908000000020BFB1A564A46560207300209EAD208DADA566300DA561C9909009A9A5A0B1205BBCD07A4C9BBCA50C050E48A50D48A0009848A54648A5454820B2B168854568854668A8BABD020148BD010148A5649D0201A5659D0101C8207900C92CF0D2840B20F7AE68850D68850E297F850CA62FA530865F8560C532D004E431F039A000B15FC8C545D006A546D15FF016C8B15F18655FAAC8B15F656090D7A2122CA20E4C37A4A213A50CD0F72094B1A50BA004D15FD0E74CEAB22094B12008A4A0008472A205A545915F1001CAC8A546915F1002CACA8671A50BC8C8C8915FA20BA900240C500868186901AA686900C8915FC88A915F204CB386718572A422C60BD0DC6559B05D8559A88A65589003C8F0522008A485318432A900E672A471F005889158D0FBC659C672D0F5E65938A531E55FA002915FA532C8E560915FA50CD062C8B15F850BA90085718572C868AA8564688565D15F900ED006C88AD15F90074C45B24C35A4C8A572057118F00A204CB38A6564AA98A42265658671C60BD0CA8572A205A5451001CAA5461002CACA8628A9002055B38A655885479865598548A8A547608422B15F852888B15F8529A910855DA200A0008A0AAA982AA8B0A406712672900B188A6528AA986529A8B093C65DD0E360A50DF00320A6B62026B538A533E531A8A534E532A200860D85628463A2904C44BC3820F0FFA900F0EBA63AE8D0A0A2152CA21B4C37A420E1B320A6B320FAAEA9808510208BB0208DAD20F7AEA9B220FFAE48A54848A54748A57B48A57A4820F8A84C4FB4A9A520FFAE098085102092B0854E844F4C8DAD20E1B3A54F48A54E4820F1AE208DAD68854E68854FA002B14E8547AAC8B14EF0998548C8B147488810FAA44820D4BBA57B48A57A48B14E857AC8B14E857BA54848A54748208AAD68854E68854F207900F0034C08AF68857A68857BA00068914E68C8914E68C8914E68C8914E68C8914E60208DADA00020DFBD6868A9FFA000F012A664A4658650845120F4B486628463856160A22286078608856F847085628463A0FFC8B16FF00CC507F004C508D0F3C922F00118846198656F8571A6709001E88672A570F004C902D00B982075B4A66FA4702088B6A616E022D005A2194C37A4A5619500A5629501A5639502A00086648465847088840D8617E8E8E8861660460F4849FF386533A434B00188C4329011D004C531900B8533843485358436AA6860A210A50F30B62026B5A980850F68D0D0A637A53886338534A000844F844EA531A632855F8660A919A20085228623C516F00520C7B5F0F7A9078553A52DA62E85228623E430D004C52FF00520BDB5F0F385588659A9038553A558A659E432D007C531D0034C06B685228623A000B122AAC8B12208C8B12265588558C8B122655985592810D38A30D0C8B122A0000A6905652285229002E623A623E459D004C558F0BA20C7B5F0F3B1223035C8B1221030C8B122F02BC8B122AAC8B122C5349006D01EE433B01AC5609016D004E45F9010865F8560A522A623854E864FA5538555A55318652285229002E623A623A00060A54F054EF0F5A55529044AA88555B14E655F855AA5606900855BA533A6348558865920BFA3A455C8A558914EAAE659A559C8914E4C2AB5A56548A564482083AE208FAD68856F688570A000B16F1871649005A2174C37A42075B4207AB6A550A45120AAB6208CB6A56FA47020AAB620CAB44CB8ADA000B16F48C8B16FAAC8B16FA86886228423A8F00A4888B122913598D0F86818653585359002E63660208FADA564A4658522842320DBB608A000B12248C8B122AAC8B122A86828D013C434D00FE433D00B4818653385339002E634688622842360C418D00CC517D0088516E9038517A0006020A1B78A48A901207DB468A000916268684CCAB42061B7D150989004B150AA98488A48207DB4A550A45120AAB668A86818652285229002E62398208CB64CCAB42061B718F15049FF4C06B7A9FF8565207900C929F00620FDAE209EB72061B7F04BCA8A4818A200F150B0B649FFC56590B1A565B0AD20F7AE68A8688555686868AA688550688551A555489848A0008A602082B74CA2B320A3B6A200860DA8602082B7F008A000B122A84CA2B34C48B2207300208AAD20B8B1A664D0F0A6654C79002082B7D0034CF7B8A67AA47B86718472A622867A1865228524A623867B9001E88625A000B1244898912420790020F3BC68A0009124A671A472867A847B60208AAD20F7B720FDAE4C9EB7A566309DA561C991B097209BBCA564A4658414851560A51548A5144820F7B7A000B114A86885146885154CA2B320EBB78AA00091146020EBB78649A200207900F00320F1B7864AA000B114454A2549F0F860A911A0BF4C67B8208CBAA56649FF8566456E856FA5614C6AB82099B9903C208CBAD0034CFCBBA6708656A269A569A8F0CE38E561F02490128461A46E846649FF6900A0008456A261D004A0008470C9F930C7A8A570560120B0B9246F1057A061E069F002A0693849FF65568570B90400F5048565B90300F5038564B90200F5028563B90100F5018562B0032047B9A0009818A662D04AA6638662A6648663A6658664A670866584706908C920D0E4A900856185666065568570A565656D8565A564656C8564A563656B8563A562656A85624C36B969010670266526642663266210F238E561B0C749FF69018561900EE661F0426662666366646665667060A56649FF8566A56249FF8562A56349FF8563A56449FF8564A56549FF8565A57049FF8570E670D00EE665D00AE664D006E663D002E66260A20F4C37A4A225B4048470B4039404B4029403B4019402A4689401690830E8F0E6E908A8A570B01416019002F601760176017602760376046AC8D0EC18608100000000037F5E56CB7980139B0B6480763893168238AA3B20803504F334813504F334808000000080317217F8202BBCF00210034C48B2A561E97F48A9808561A9D6A0B92067B8A9DBA0B9200FBBA9BCA0B92050B8A9C1A0B92043E0A9E0A0B92067B868207EBDA9E5A0B9208CBAD0034C8BBA20B7BAA9008526852785288529A5702059BAA5652059BAA5642059BAA5632059BAA562205EBA4C8FBBD0034C83B94A0980A8901918A529656D8529A528656C8528A527656B8527A526656A852666266627662866296670984AD0D66085228423A004B122856D88B122856C88B122856B88B122856E4566856FA56E0980856A88B1228569A56160A569F01F1865619004301D182C101469808561D0034CFBB8A56F856660A56649FF300568684CF7B84C7EB9200CBCAAF010186902B0F2A200866F2077B8E661F0E7608420000000200CBCA9F9A0BAA200866F20A2BB4C12BB208CBAF076201BBCA90038E561856120B7BAE661F0BAA2FCA901A46AC462D010A46BC463D00AA46CC464D004A46DC465082A9009E89529F0321034A90128B00E066D266C266B266AB0E630CE10E2A8A56DE565856DA56CE564856CA56BE563856BA56AE562856A984C4FBBA940D0CE0A0A0A0A0A0A8570284C8FBBA2144C37A4A5268562A5278563A5288564A52985654CD7B885228423A004B122856588B122856488B122856388B12285660980856288B1228561847060A25C2CA257A000F004A649A44A201BBC86228423A004A565912288A564912288A563912288A566097F2562912288A5619122847060A56E8566A205B5689560CAD0F9867060201BBCA206B5609568CAD0F9867060A561F0FB067090F7206FB9D0F24C38B9A561F009A5662AA9FFB002A90160202BBC8562A9008563A288A56249FF2AA900856585648661857085664CD2B846666085248425A000B124C8AAF0C4B124456630C2E461D021B1240980C562D019C8B124C563D012C8B124C564D00BC8A97FC570B124E565F028A566900249FF4C31BCA561F04A38E9A024661009AAA9FF8568204DB98AA261C9F910062099B9846860A8A566298046620562856220B0B9846860A561C9A0B020209BBC8470A566846649802AA9A08561A56585074CD2B88562856385648565A860A000A20A945DCA10FB900FC92DD0048667F004C92BD005207300905BC92EF02EC945D0302073009017C9ABF00EC92DF00AC9AAF008C92BF004D0076660207300905C2460100EA90038E55E4C49BD665F245F50C3A55E38E55D855EF012100920FEBAE65ED0F9F00720E2BAC65ED0F9A5673001604CB4BF48245F1002E65D20E2BA6838E930207EBD4C0ABD48200CBC68203CBCA56E4566856FA6614C6AB8A55EC90A9009A964246030114C7EB90A0A18655E0A18A000717A38E930855E4C30BD9B3EBC1FFD9E6E6B27FD9E6E6B2800A971A0A320DABDA53AA63985628663A290382049BC20DFBD4C1EABA001A92024661002A92D99FF0085668471C8A930A661D0034C04BFA900E080F002B009A9BDA0BD2028BAA9F7855DA9B8A0BD205BBCF01E1012A9B3A0BD205BBCF002100E20E2BAC65DD0EE20FEBAE65DD0DC2049B8209BBCA201A55D18690A3009C90BB00669FFAAA90238E902855E865D8AF0021013A471A92EC899FF008AF006A930C899FF008471A000A280A565187919BF8565A5647918BF8564A5637917BF8563A5627916BF8562E8B00410DE300230DA8A900449FF690A692FC8C8C8C88447A471C8AA297F99FF00C65DD006A92EC899FF008471A4478A49FF2980AAC024F004C03CD0A6A471B9FF0088C930F0F8C92EF001C8A92BA65EF02E1008A90038E55EAAA92D990101A9459900018AA22F38E8E90AB0FB693A9903018A990201A900990401F00899FF00A900990001A900A001608000000000FA0A1F0000989680FFF0BDC0000186A0FFFFD8F0000003E8FFFFFF9C0000000AFFFFFFFFFFDF0A8000034BC0FFFF736000000E10FFFFFDA80000003CECAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA200CBCA911A0BF20A2BBF070A569D0034CF9B8A24EA00020D4BBA56E100F20CCBCA94EA000205BBCD00398A40720FEBB984820EAB9A94EA0002028BA20EDBF684A900AA561F006A56649FF8566608138AA3B29077134583E5674167EB31B772FEEE3857A1D841C2A7C6359580A7E75FDE7C680317218108100000000A9BFA0BF2028BAA570695090032023BC4C00E0" );
      CharacterROM    = StringToByteArray( "3C666E6E60623C00183C667E666666007C66667C66667C003C66606060663C00786C6666666C78007E60607860607E007E606078606060003C66606E66663C006666667E666666003C18181818183C001E0C0C0C0C6C3800666C7870786C66006060606060607E0063777F6B6363630066767E7E6E6666003C66666666663C007C66667C606060003C666666663C0E007C66667C786C66003C66603C06663C007E181818181818006666666666663C0066666666663C18006363636B7F77630066663C183C6666006666663C181818007E060C1830607E003C30303030303C000C12307C3062FC003C0C0C0C0C0C3C0000183C7E181818180010307F7F3010000000000000000000181818180000180066666600000000006666FF66FF666600183E603C067C180062660C18306646003C663C3867663F00060C1800000000000C18303030180C0030180C0C0C18300000663CFF3C6600000018187E1818000000000000001818300000007E0000000000000000001818000003060C183060003C666E7666663C001818381818187E003C66060C30607E003C66061C06663C00060E1E667F0606007E607C0606663C003C66607C66663C007E660C18181818003C66663C66663C003C66663E06663C00000018000018000000001800001818300E18306030180E0000007E007E00000070180C060C1870003C66060C18001800000000FFFF000000081C3E7F7F1C3E001818181818181818000000FFFF0000000000FFFF0000000000FFFF000000000000000000FFFF000030303030303030300C0C0C0C0C0C0C0C000000E0F038181818181C0F07000000181838F0E0000000C0C0C0C0C0C0FFFFC0E070381C0E070303070E1C3870E0C0FFFFC0C0C0C0C0C0FFFF030303030303003C7E7E7E7E3C000000000000FFFF00367F7F7F3E1C08006060606060606060000000070F1C1818C3E77E3C3C7EE7C3003C7E66667E3C001818666618183C000606060606060606081C3E7F3E1C0800181818FFFF181818C0C03030C0C0303018181818181818180000033E76363600FF7F3F1F0F0703010000000000000000F0F0F0F0F0F0F0F000000000FFFFFFFFFF0000000000000000000000000000FFC0C0C0C0C0C0C0C0CCCC3333CCCC3333030303030303030300000000CCCC3333FFFEFCF8F0E0C08003030303030303031818181F1F181818000000000F0F0F0F1818181F1F000000000000F8F8181818000000000000FFFF0000001F1F181818181818FFFF000000000000FFFF181818181818F8F8181818C0C0C0C0C0C0C0C0E0E0E0E0E0E0E0E00707070707070707FFFF000000000000FFFFFF00000000000000000000FFFFFF030303030303FFFF00000000F0F0F0F00F0F0F0F00000000181818F8F8000000F0F0F0F000000000F0F0F0F00F0F0F0FC39991919F99C3FFE7C39981999999FF83999983999983FFC3999F9F9F99C3FF87939999999387FF819F9F879F9F81FF819F9F879F9F9FFFC3999F919999C3FF99999981999999FFC3E7E7E7E7E7C3FFE1F3F3F3F393C7FF9993878F879399FF9F9F9F9F9F9F81FF9C8880949C9C9CFF99898181919999FFC39999999999C3FF839999839F9F9FFFC399999999C3F1FF83999983879399FFC3999FC3F999C3FF81E7E7E7E7E7E7FF999999999999C3FF9999999999C3E7FF9C9C9C9480889CFF9999C3E7C39999FF999999C3E7E7E7FF81F9F3E7CF9F81FFC3CFCFCFCFCFC3FFF3EDCF83CF9D03FFC3F3F3F3F3F3C3FFFFE7C381E7E7E7E7FFEFCF8080CFEFFFFFFFFFFFFFFFFFFFE7E7E7E7FFFFE7FF999999FFFFFFFFFF99990099009999FFE7C19FC3F983E7FF9D99F3E7CF99B9FFC399C3C79899C0FFF9F3E7FFFFFFFFFFF3E7CFCFCFE7F3FFCFE7F3F3F3E7CFFFFF99C300C399FFFFFFE7E781E7E7FFFFFFFFFFFFFFE7E7CFFFFFFF81FFFFFFFFFFFFFFFFFFE7E7FFFFFCF9F3E7CF9FFFC39991899999C3FFE7E7C7E7E7E781FFC399F9F3CF9F81FFC399F9E3F999C3FFF9F1E19980F9F9FF819F83F9F999C3FFC3999F839999C3FF8199F3E7E7E7E7FFC39999C39999C3FFC39999C1F999C3FFFFFFE7FFFFE7FFFFFFFFE7FFFFE7E7CFF1E7CF9FCFE7F1FFFFFF81FF81FFFFFF8FE7F3F9F3E78FFFC399F9F3E7FFE7FFFFFFFF0000FFFFFFF7E3C18080E3C1FFE7E7E7E7E7E7E7E7FFFFFF0000FFFFFFFFFF0000FFFFFFFFFF0000FFFFFFFFFFFFFFFFFF0000FFFFCFCFCFCFCFCFCFCFF3F3F3F3F3F3F3F3FFFFFF1F0FC7E7E7E7E7E3F0F8FFFFFFE7E7C70F1FFFFFFF3F3F3F3F3F3F00003F1F8FC7E3F1F8FCFCF8F1E3C78F1F3F00003F3F3F3F3F3F0000FCFCFCFCFCFCFFC381818181C3FFFFFFFFFFFF0000FFC9808080C1E3F7FF9F9F9F9F9F9F9F9FFFFFFFF8F0E3E7E73C1881C3C381183CFFC381999981C3FFE7E79999E7E7C3FFF9F9F9F9F9F9F9F9F7E3C180C1E3F7FFE7E7E70000E7E7E73F3FCFCF3F3FCFCFE7E7E7E7E7E7E7E7FFFFFCC189C9C9FF0080C0E0F0F8FCFEFFFFFFFFFFFFFFFF0F0F0F0F0F0F0F0FFFFFFFFF0000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF003F3F3F3F3F3F3F3F3333CCCC3333CCCCFCFCFCFCFCFCFCFCFFFFFFFF3333CCCC000103070F1F3F7FFCFCFCFCFCFCFCFCE7E7E7E0E0E7E7E7FFFFFFFFF0F0F0F0E7E7E7E0E0FFFFFFFFFFFF0707E7E7E7FFFFFFFFFFFF0000FFFFFFE0E0E7E7E7E7E7E70000FFFFFFFFFFFF0000E7E7E7E7E7E70707E7E7E73F3F3F3F3F3F3F3F1F1F1F1F1F1F1F1FF8F8F8F8F8F8F8F80000FFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFF000000FCFCFCFCFCFC0000FFFFFFFF0F0F0F0FF0F0F0F0FFFFFFFFE7E7E70707FFFFFF0F0F0F0FFFFFFFFF0F0F0F0FF0F0F0F03C666E6E60623C0000003C063E663E000060607C66667C0000003C6060603C000006063E66663E0000003C667E603C00000E183E1818180000003E66663E067C0060607C666666000018003818183C00000600060606063C0060606C786C66000038181818183C000000667F7F6B630000007C666666660000003C6666663C0000007C66667C606000003E66663E060600007C666060600000003E603C067C0000187E1818180E000000666666663E0000006666663C18000000636B7F3E36000000663C183C660000006666663E0C7800007E0C18307E003C30303030303C000C12307C3062FC003C0C0C0C0C0C3C0000183C7E181818180010307F7F3010000000000000000000181818180000180066666600000000006666FF66FF666600183E603C067C180062660C18306646003C663C3867663F00060C1800000000000C18303030180C0030180C0C0C18300000663CFF3C6600000018187E1818000000000000001818300000007E0000000000000000001818000003060C183060003C666E7666663C001818381818187E003C66060C30607E003C66061C06663C00060E1E667F0606007E607C0606663C003C66607C66663C007E660C18181818003C66663C66663C003C66663E06663C00000018000018000000001800001818300E18306030180E0000007E007E00000070180C060C1870003C66060C18001800000000FFFF000000183C667E666666007C66667C66667C003C66606060663C00786C6666666C78007E60607860607E007E606078606060003C66606E66663C006666667E666666003C18181818183C001E0C0C0C0C6C3800666C7870786C66006060606060607E0063777F6B6363630066767E7E6E6666003C66666666663C007C66667C606060003C666666663C0E007C66667C786C66003C66603C06663C007E181818181818006666666666663C0066666666663C18006363636B7F77630066663C183C6666006666663C181818007E060C1830607E00181818FFFF181818C0C03030C0C0303018181818181818183333CCCC3333CCCC3399CC663399CC660000000000000000F0F0F0F0F0F0F0F000000000FFFFFFFFFF0000000000000000000000000000FFC0C0C0C0C0C0C0C0CCCC3333CCCC3333030303030303030300000000CCCC3333CC993366CC99336603030303030303031818181F1F181818000000000F0F0F0F1818181F1F000000000000F8F8181818000000000000FFFF0000001F1F181818181818FFFF000000000000FFFF181818181818F8F8181818C0C0C0C0C0C0C0C0E0E0E0E0E0E0E0E00707070707070707FFFF000000000000FFFFFF00000000000000000000FFFFFF0103066C7870600000000000F0F0F0F00F0F0F0F00000000181818F8F8000000F0F0F0F000000000F0F0F0F00F0F0F0FC39991919F99C3FFFFFFC3F9C199C1FFFF9F9F83999983FFFFFFC39F9F9FC3FFFFF9F9C19999C1FFFFFFC399819FC3FFFFF1E7C1E7E7E7FFFFFFC19999C1F983FF9F9F83999999FFFFE7FFC7E7E7C3FFFFF9FFF9F9F9F9C3FF9F9F93879399FFFFC7E7E7E7E7C3FFFFFF998080949CFFFFFF8399999999FFFFFFC3999999C3FFFFFF839999839F9FFFFFC19999C1F9F9FFFF83999F9F9FFFFFFFC19FC3F983FFFFE781E7E7E7F1FFFFFF99999999C1FFFFFF999999C3E7FFFFFF9C9480C1C9FFFFFF99C3E7C399FFFFFF999999C1F387FFFF81F3E7CF81FFC3CFCFCFCFCFC3FFF3EDCF83CF9D03FFC3F3F3F3F3F3C3FFFFE7C381E7E7E7E7FFEFCF8080CFEFFFFFFFFFFFFFFFFFFFE7E7E7E7FFFFE7FF999999FFFFFFFFFF99990099009999FFE7C19FC3F983E7FF9D99F3E7CF99B9FFC399C3C79899C0FFF9F3E7FFFFFFFFFFF3E7CFCFCFE7F3FFCFE7F3F3F3E7CFFFFF99C300C399FFFFFFE7E781E7E7FFFFFFFFFFFFFFE7E7CFFFFFFF81FFFFFFFFFFFFFFFFFFE7E7FFFFFCF9F3E7CF9FFFC39991899999C3FFE7E7C7E7E7E781FFC399F9F3CF9F81FFC399F9E3F999C3FFF9F1E19980F9F9FF819F83F9F999C3FFC3999F839999C3FF8199F3E7E7E7E7FFC39999C39999C3FFC39999C1F999C3FFFFFFE7FFFFE7FFFFFFFFE7FFFFE7E7CFF1E7CF9FCFE7F1FFFFFF81FF81FFFFFF8FE7F3F9F3E78FFFC399F9F3E7FFE7FFFFFFFF0000FFFFFFE7C39981999999FF83999983999983FFC3999F9F9F99C3FF87939999999387FF819F9F879F9F81FF819F9F879F9F9FFFC3999F919999C3FF99999981999999FFC3E7E7E7E7E7C3FFE1F3F3F3F393C7FF9993878F879399FF9F9F9F9F9F9F81FF9C8880949C9C9CFF99898181919999FFC39999999999C3FF839999839F9F9FFFC399999999C3F1FF83999983879399FFC3999FC3F999C3FF81E7E7E7E7E7E7FF999999999999C3FF9999999999C3E7FF9C9C9C9480889CFF9999C3E7C39999FF999999C3E7E7E7FF81F9F3E7CF9F81FFE7E7E70000E7E7E73F3FCFCF3F3FCFCFE7E7E7E7E7E7E7E7CCCC3333CCCC3333CC663399CC663399FFFFFFFFFFFFFFFF0F0F0F0F0F0F0F0FFFFFFFFF0000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFF003F3F3F3F3F3F3F3F3333CCCC3333CCCCFCFCFCFCFCFCFCFCFFFFFFFF3333CCCC3366CC993366CC99FCFCFCFCFCFCFCFCE7E7E7E0E0E7E7E7FFFFFFFFF0F0F0F0E7E7E7E0E0FFFFFFFFFFFF0707E7E7E7FFFFFFFFFFFF0000FFFFFFE0E0E7E7E7E7E7E70000FFFFFFFFFFFF0000E7E7E7E7E7E70707E7E7E73F3F3F3F3F3F3F3F1F1F1F1F1F1F1F1FF8F8F8F8F8F8F8F80000FFFFFFFFFFFF000000FFFFFFFFFFFFFFFFFFFF000000FEFCF993878F9FFFFFFFFFFF0F0F0F0FF0F0F0F0FFFFFFFFE7E7E70707FFFFFF0F0F0F0FFFFFFFFF0F0F0F0FF0F0F0F0" );

      Range0000To0FFF = MemorySource.RAM;
      Range1000To7FFF = MemorySource.RAM;
      Range8000To9FFF = MemorySource.RAM;
      RangeA000ToBFFF = MemorySource.BASIC_ROM;
      RangeC000ToCFFF = MemorySource.RAM;
      RangeD000ToDFFF = MemorySource.IO;
      RangeE000ToFFFF = MemorySource.KERNAL_ROM;
    }



    public ByteBuffer ForCPU( int StartAddress, int Size )
    {
      if ( ( StartAddress < 0 )
      ||   ( Size < 0 )
      ||   ( StartAddress + Size >= 65536 ) )
      {
        Debug.Log( "ForCPU - invalid memory range!" );
        return new ByteBuffer( (uint)Size );
      }

      var result = new ByteBuffer( (uint)Size );

      /*
      Range0000To0FFF = MemorySource.RAM;
    internal MemorySource   Range1000To7FFF = MemorySource.RAM;
    internal MemorySource   Range8000To9FFF = MemorySource.RAM;
    internal MemorySource   RangeA000ToBFFF = MemorySource.BASIC_ROM;
    internal MemorySource   RangeC000ToCFFF = MemorySource.RAM;
    internal MemorySource   RangeD000ToDFFF = MemorySource.IO;
    internal MemorySource   RangeE000ToFFFF = MemorySource.KERNAL_ROM;*/

      FetchMemoryRange( StartAddress, Size, 0x0000, 0x0fff, Range0000To0FFF, result );
      FetchMemoryRange( StartAddress, Size, 0x1000, 0x7fff, Range1000To7FFF, result );
      FetchMemoryRange( StartAddress, Size, 0x8000, 0x9fff, Range8000To9FFF, result );
      FetchMemoryRange( StartAddress, Size, 0xa000, 0xbfff, RangeA000ToBFFF, result );
      FetchMemoryRange( StartAddress, Size, 0xc000, 0xcfff, RangeC000ToCFFF, result );
      FetchMemoryRange( StartAddress, Size, 0xd000, 0xdfff, RangeD000ToDFFF, result );
      FetchMemoryRange( StartAddress, Size, 0xe000, 0xffff, RangeE000ToFFFF, result );

      return result;      
    }



    private void FetchMemoryRange( int StartAddress, int Size, int RangeStart, int RangeEnd, MemorySource Source, ByteBuffer Result )
    {
      if ( ( StartAddress <= RangeEnd )
      &&   ( StartAddress + Size - 1 >= RangeStart ) )
      {
        int     localStart = Math.Max( StartAddress, RangeStart );
        int     localEnd = Math.Min( StartAddress + Size - 1, RangeEnd );

        switch ( Source )
        {
          case MemorySource.RAM:
            System.Array.Copy( RAM, localStart, Result.Data(), localStart - StartAddress, localEnd - localStart + 1 );
            break;
          case MemorySource.KERNAL_ROM:
            System.Array.Copy( Kernal, localStart - RangeStart, Result.Data(), localStart - StartAddress, localEnd - localStart + 1 );
            break;
          case MemorySource.BASIC_ROM:
            System.Array.Copy( BASICROM, localStart - RangeStart, Result.Data(), localStart - StartAddress, localEnd - localStart + 1 );
            break;
          case MemorySource.CHARSET_ROM:
            System.Array.Copy( CharacterROM, localStart - RangeStart, Result.Data(), localStart - StartAddress, localEnd - localStart + 1 );
            break;
          case MemorySource.CART_HI:
            System.Array.Copy( CartHI, localStart - RangeStart, Result.Data(), localStart - StartAddress, localEnd - localStart + 1 );
            break;
          case MemorySource.CART_LO:
            System.Array.Copy( CartLO, localStart - RangeStart, Result.Data(), localStart - StartAddress, localEnd - localStart + 1 );
            break;
          case MemorySource.IO:
            for ( int i = localStart; i <= localEnd; ++i )
            {
              Result.SetU8At( i - StartAddress, ReadFromIO( (ushort)i ) );
            }
            break;
          default:
            Debug.Log( "FetchMemoryRange unsupported source " + Source );
            break;
        }
      }
    }



    public void SetupMapping( bool Game, bool ExRom, bool CharEn, bool HiRam, bool LoRam )
    {
      // always
      Range0000To0FFF = MemorySource.RAM;

      // 0x1000 to 0x7fff
      if ( ( !Game )
      &&   ( ExRom ) )
      {
        Range1000To7FFF = MemorySource.UNDEFINED;
      }
      else
      {
        Range1000To7FFF = MemorySource.RAM;
      }

      // 0x8000 to 0x9fff
      if ( ( Game )
      &&   ( !ExRom )
      &&   ( CharEn )
      &&   ( HiRam )
      &&   ( LoRam ) ) 
      {
        Range8000To9FFF = MemorySource.CART_LO;
      }
      else if ( ( Game )
      &&        ( !ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        Range8000To9FFF = MemorySource.CART_LO;
      }
      else if ( ( !Game )
      &&        ( ExRom ) )
      {
        Range8000To9FFF = MemorySource.CART_LO;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        Range8000To9FFF = MemorySource.CART_LO;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        Range8000To9FFF = MemorySource.CART_LO;
      }
      else
      {
        Range8000To9FFF = MemorySource.RAM;
      }

      // 0xA000 to 0xBfff
      if ( ( Game )
      &&   ( ExRom )
      &&   ( CharEn )
      &&   ( HiRam )
      &&   ( LoRam ) )
      {
        RangeA000ToBFFF = MemorySource.BASIC_ROM;
      }
      else if ( ( Game )
      &&        ( ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeA000ToBFFF = MemorySource.BASIC_ROM;
      }
      else if ( ( Game )
      &&        ( !ExRom )
      &&        ( CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeA000ToBFFF = MemorySource.BASIC_ROM;
      }
      else if ( ( Game )
      &&        ( !ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeA000ToBFFF = MemorySource.BASIC_ROM;
      }
      else if ( ( !Game )
      &&        ( ExRom ) )
      {
        RangeA000ToBFFF = MemorySource.UNDEFINED;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeA000ToBFFF = MemorySource.CART_HI;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( CharEn )
      &&        ( HiRam )
      &&        ( !LoRam ) )
      {
        RangeA000ToBFFF = MemorySource.CART_HI;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeA000ToBFFF = MemorySource.CART_HI;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( !LoRam ) )
      {
        RangeA000ToBFFF = MemorySource.CART_HI;
      }
      else
      {
        RangeA000ToBFFF = MemorySource.RAM;
      }

      // 0xC000 to 0xCfff
      if ( ( !Game )
      &&   ( ExRom ) )
      {
        RangeC000ToCFFF = MemorySource.UNDEFINED;
      }
      else
      {
        RangeC000ToCFFF = MemorySource.RAM;
      }

      // 0xD000 to 0xDfff
      if ( ( Game )
      &&   ( ExRom )
      &&   ( CharEn )
      &&   ( HiRam )
      &&   ( LoRam ) )
      {
        RangeD000ToDFFF = MemorySource.IO;
      }
      else if ( ( Game )
      &&        ( CharEn )
      &&        ( HiRam )
      &&        ( !LoRam ) )
      {
        RangeD000ToDFFF = MemorySource.IO;
      }
      else if ( ( Game )
      &&        ( CharEn )
      &&        ( !HiRam )
      &&        ( LoRam ) )
      {
        RangeD000ToDFFF = MemorySource.IO;
      }
      else if ( ( Game )
      &&        ( ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeD000ToDFFF = MemorySource.CHARSET_ROM;
      }
      else if ( ( Game )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( !LoRam ) )
      {
        RangeD000ToDFFF = MemorySource.CHARSET_ROM;
      }
      else if ( ( Game )
      &&        ( !CharEn )
      &&        ( !HiRam )
      &&        ( LoRam ) )
      {
        RangeD000ToDFFF = MemorySource.CHARSET_ROM;
      }
      else if ( ( Game )
      &&        ( !ExRom )
      &&        ( CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeD000ToDFFF = MemorySource.IO;
      }
      else if ( ( Game )
      &&        ( !ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeD000ToDFFF = MemorySource.CHARSET_ROM;
      }
      else if ( ( !Game )
      &&        ( ExRom ) )
      {
        RangeD000ToDFFF = MemorySource.IO;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeD000ToDFFF = MemorySource.IO;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( CharEn )
      &&        ( HiRam )
      &&        ( !LoRam ) )
      {
        RangeD000ToDFFF = MemorySource.IO;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( CharEn )
      &&        ( !HiRam )
      &&        ( LoRam ) )
      {
        RangeD000ToDFFF = MemorySource.IO;
      }    
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeD000ToDFFF = MemorySource.CHARSET_ROM;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( !LoRam ) )
      {
        RangeD000ToDFFF = MemorySource.CHARSET_ROM;
      }
      else
      {
        RangeD000ToDFFF = MemorySource.RAM;
      }

      // 0xE000 to 0xFFFF
      if ( ( Game )
      &&   ( ExRom )
      &&   ( CharEn )
      &&   ( HiRam )
      &&   ( LoRam ) )
      {
        RangeE000ToFFFF = MemorySource.KERNAL_ROM;
      }
      else if ( ( Game )
      &&        ( CharEn )
      &&        ( HiRam )
      &&        ( !LoRam ) )
      {
        RangeE000ToFFFF = MemorySource.KERNAL_ROM;
      }
      else if ( ( Game )
      &&        ( ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeE000ToFFFF = MemorySource.KERNAL_ROM;
      }
      else if ( ( Game )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( !LoRam ) )
      {
        RangeE000ToFFFF = MemorySource.KERNAL_ROM;
      }
      else if ( ( Game )
      &&        ( !ExRom )
      &&        ( CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeE000ToFFFF = MemorySource.KERNAL_ROM;
      }
      else if ( ( Game )
      &&        ( !ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeE000ToFFFF = MemorySource.KERNAL_ROM;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeE000ToFFFF = MemorySource.KERNAL_ROM;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( CharEn )
      &&        ( HiRam )
      &&        ( !LoRam ) )
      {
        RangeE000ToFFFF = MemorySource.KERNAL_ROM;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( LoRam ) )
      {
        RangeE000ToFFFF = MemorySource.KERNAL_ROM;
      }
      else if ( ( !Game )
      &&        ( !ExRom )
      &&        ( !CharEn )
      &&        ( HiRam )
      &&        ( !LoRam ) )
      {
        RangeE000ToFFFF = MemorySource.KERNAL_ROM;
      }
      else if ( ( !Game )
      &&        ( ExRom ) )
      {
        RangeE000ToFFFF = MemorySource.CART_HI;
      }
      else
      {
        RangeE000ToFFFF = MemorySource.RAM;
      }
    }



    internal static byte[] StringToByteArray( string hex )
    {
      int NumberChars = hex.Length;
      byte[] bytes = new byte[NumberChars / 2];
      for ( int i = 0; i < NumberChars; i += 2 )
      {
        bytes[i / 2] = Convert.ToByte( hex.Substring( i, 2 ), 16 );
      }
      return bytes;
    }



    public ushort ReadWordDirect( ushort Address )
    {
      byte  lo = ReadByteDirect( Address );
      byte  hi = ReadByteDirect( (ushort)( Address + 1 ) );

      return (ushort)( lo + ( hi << 8 ) );
    }



    public byte ReadByteDirectAsVIC( ushort Address )
    {
      if ( ( Address >= 0x1000 )
      &&   ( Address < 0x2000 ) )
      {
        return CharacterROM[Address & 0xfff];
      }
      else if ( ( Address >= 0x9000 )
      &&        ( Address < 0xa000 ) )
      {
        return CharacterROM[Address & 0xfff];
      }
      return ReadByteDirect( Address );
    }



    public byte ReadByteDirect( ushort Address )
    {
      if ( ( Address >= 0x0000 )
      &&   ( Address < 0x1000 ) )
      {
        return RAM[Address];
      }
      else if ( ( Address >= 0x1000 )
      &&        ( Address < 0x8000 ) )
      {
        switch ( Range1000To7FFF )
        {
          case MemorySource.RAM:
            return RAM[Address];
          case MemorySource.UNDEFINED:
            return (byte)new Random().Next( 256 );
        }
      }
      else if ( ( Address >= 0x8000 )
      &&        ( Address < 0xA000 ) )
      {
        switch ( Range8000To9FFF )
        {
          case MemorySource.CART_LO:
            return CartLO[Address - 0x1000];
          case MemorySource.RAM:
            return RAM[Address];
        }
      }
      else if ( ( Address >= 0xA000 )
      &&        ( Address < 0xC000 ) )
      {
        switch ( RangeA000ToBFFF )
        {
          case MemorySource.RAM:
            return RAM[Address];
          case MemorySource.BASIC_ROM:
            return BASICROM[Address - 0xA000];
          case MemorySource.CART_HI:
            return CartHI[Address - 0xA000];
          case MemorySource.UNDEFINED:
            return (byte)new Random().Next( 256 );
        }
      }
      else if ( ( Address >= 0xC000 )
      &&        ( Address < 0xD000 ) )
      {
        switch ( RangeC000ToCFFF )
        {
          case MemorySource.RAM:
            return RAM[Address];
          case MemorySource.UNDEFINED:
            return (byte)new Random().Next( 256 );
        }
      }
      else if ( ( Address >= 0xD000 )
      &&        ( Address < 0xE000 ) )
      {
        switch ( RangeD000ToDFFF )
        {
          case MemorySource.RAM:
            return RAM[Address];
          case MemorySource.CHARSET_ROM:
            return CharacterROM[Address - 0xD000];
          case MemorySource.IO:
            return ReadFromIO( Address );
        }
      }
      else if ( Address >= 0xE000 )
      {
        switch ( RangeE000ToFFFF )
        {
          case MemorySource.RAM:
            return RAM[Address];
          case MemorySource.KERNAL_ROM:
            return Kernal[Address - 0xE000];
          case MemorySource.CART_HI:
            return CartHI[Address - 0xE000];
        }
      }
      throw new ArgumentException( "Address out of bounds or no range set!" );
    }



    internal byte ReadByte( int Address )
    {
      if ( Address >= 65536 )
      {
        Address &= 0xffff;
      }
      return ReadByteDirect( (ushort)Address );
    }



    internal ushort ReadWord( int Address )
    {
      return ReadWordDirect( (ushort)Address );
    }



    internal void WriteByte( ushort Address, byte Value )
    {
      if ( ( Address >= 0x0000 )
      &&   ( Address < 0x1000 ) )
      {
        RAM[Address] = Value;
        return;
      }
      else if ( ( Address >= 0x1000 )
      &&        ( Address < 0x8000 ) )
      {
        switch ( Range1000To7FFF )
        {
          case MemorySource.RAM:
            RAM[Address] = Value;
            return;
          case MemorySource.UNDEFINED:
            return;
        }
      }
      else if ( ( Address >= 0x8000 )
      &&        ( Address < 0xA000 ) )
      {
        switch ( Range8000To9FFF )
        {
          case MemorySource.CART_LO:
          case MemorySource.RAM:
            RAM[Address] = Value;
            return;
        }
      }
      else if ( ( Address >= 0xA000 )
      &&        ( Address < 0xC000 ) )
      {
        switch ( RangeA000ToBFFF )
        {
          case MemorySource.CART_HI:
          case MemorySource.BASIC_ROM:
          case MemorySource.RAM:
            RAM[Address] = Value;
            return;
          case MemorySource.UNDEFINED:
            return;
        }
      }
      else if ( ( Address >= 0xC000 )
      &&        ( Address < 0xD000 ) )
      {
        switch ( RangeC000ToCFFF )
        {
          case MemorySource.RAM:
            RAM[Address] = Value;
            return;
          case MemorySource.UNDEFINED:
            return;
        }
      }
      else if ( ( Address >= 0xD000 )
      &&        ( Address < 0xE000 ) )
      {
        switch ( RangeD000ToDFFF )
        {
          case MemorySource.CHARSET_ROM:
          case MemorySource.RAM:
            RAM[Address] = Value;
            return;
          case MemorySource.IO:
            WriteToIO( Address, Value );
            return;
        }
      }
      else if ( Address >= 0xE000 )
      {
        switch ( RangeE000ToFFFF )
        {
          case MemorySource.RAM:
          case MemorySource.KERNAL_ROM:
          case MemorySource.CART_HI:
            RAM[Address] = Value;
            return;
        }
      }
    }



    private byte ReadFromIO( ushort Address )
    {
      if ( ( Address >= 0xd000 )
      &&   ( Address < 0xd400 ) )
      {
        // VIC

        // TODO - proper handling!
        byte vicAddress = (byte)( Address & 0x003f );
        return Machine.VIC.ReadByte( vicAddress );
      }
      else if ( ( Address >= 0xd400 )
      &&        ( Address < 0xd800 ) )
      {
        // SID
        return Machine.SID.ReadByte( (byte)( Address & 0x01f ) );
      }
      else if ( ( Address >= 0xd800 )
      &&        ( Address < 0xd800 + 1024 ) )
      {
        // Color RAM
        byte    color = ColorRAM[Address - 0xd800];

        // random upper nibble
        color = (byte)( color + ( new Random().Next( 16 ) << 4 ) );
        return color;
      }
      else if ( ( Address >= 0xdc00 )
      &&        ( Address < 0xdd00 ) )
      {
        // CIA1
        return Machine.CIA1.ReadByte( (byte)( Address & 0x0f ) );
      }
      else if ( ( Address >= 0xdd00 )
      &&        ( Address < 0xde00 ) )
      {
        // CIA2
        return Machine.CIA2.ReadByte( (byte)( Address & 0x0f ) );
      }
      // TODO
      throw new NotSupportedException( "Unsupported IO address " + Address.ToString( "X4" ) );
    }



    private void WriteToIO( ushort Address, byte Value )
    {
      // TODO - send to VIC/SID/CIA/etc...
      if ( ( Address >= 0xd000 )
      &&   ( Address < 0xd400 ) )
      {
        // VIC
        byte vicAddress = (byte)( Address & 0x003f );

        Machine.VIC.WriteByte( vicAddress, Value );
      }
      else if ( ( Address >= 0xd400 )
      &&        ( Address < 0xd800 ) )
      {
        // SID
        Machine.SID.WriteByte( (byte)( Address & 0x0ff ), Value );
      }
      else if ( ( Address >= 0xd800 )
      &&        ( Address < 0xd800 + 1024 ) )
      {
        // Color RAM
        ColorRAM[Address - 0xd800] = (byte)( Value & 0x0f );
      }
      else if ( ( Address >= 0xdc00 )
      &&        ( Address < 0xdd00 ) )
      {
        // CIA1
        Machine.CIA1.WriteByte( (byte)( Address & 0x0f ), Value );
      }
      else if ( ( Address >= 0xdd00 )
      &&        ( Address < 0xde00 ) )
      {
        // CIA2
        Machine.CIA2.WriteByte( (byte)( Address & 0x0f ), Value );
      }
      else
      {
        // ignore?
        //throw new NotSupportedException( "Unsupported write to IO address " + Address.ToString( "X4" ) );
      }
    }

  }
}
